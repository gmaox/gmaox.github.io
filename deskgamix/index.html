<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeskGamix 更新中心</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .update-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 2rem;
        }

        .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h1 {
            color: #2d3748;
            font-size: 1.8rem;
        }

        .version-tag {
            display: inline-block;
            background-color: #4299e1;
            color: white;
            padding: 0.2rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .update-info {
            margin: 1.5rem 0;
            line-height: 1.8;
            color: #4a5568;
        }

        .update-info h3 {
            color: #2d3748;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        .update-info ul {
            padding-left: 1.5rem;
        }

        .download-area {
            margin: 2rem 0;
        }

        .link-switch {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .link-switch label {
            margin-right: 1.5rem;
            color: #4a5568;
            cursor: pointer;
            font-weight: 500;
        }

        .file-list {
            display: grid;
            gap: 0.8rem;
        }

        .download-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            background-color: #38b2ac;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.1rem;
            transition: background-color 0.3s;
        }

        .download-btn:hover {
            background-color: #319795;
        }

        .file-name {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 0.3rem;
            text-align: center;
        }

        .tips {
            color: #718096;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-top: 1rem;
        }

        .loading, .error {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        /* 历史版本按钮样式 */
        .history-btn-area {
            margin-top: 2rem;
            text-align: center;
        }

        .history-btn {
            padding: 0.8rem 2rem;
            background-color: #e2e8f0;
            color: #2d3748;
            text-decoration: none;
            border-radius: 6px;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .history-btn:hover {
            background-color: #cbd5e1;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">正在获取最新版本信息...</div>
    <div class="error" id="error" style="display: none;">获取版本信息失败，请稍后重试</div>
    <div class="update-card" id="updateCard" style="display: none;">
        <div class="card-header">
            <h1>DeskGamix 更新中心</h1>
            <span class="version-tag" id="version">v1.0.0</span>
        </div>

        <div class="update-info">
            <h3>更新日志</h3>
            <ul id="changelog">
                <!-- 动态填充更新日志 -->
            </ul>
        </div>

        <div class="download-area">
            <div class="link-switch">
                <label>
                    <input type="radio" name="linkType" value="accelerate" checked> 国内加速
                </label>
                <label>
                    <input type="radio" name="linkType" value="official"> 官方链接
                </label>
            </div>
            <div class="file-list" id="fileList">
                <!-- 动态填充下载按钮 -->
            </div>
            <div class="tips">
                提示：下载完成后请关闭软件再进行安装；若加速链接失效，请切换至官方链接。
            </div>
        </div>

        <!-- 新增历史版本按钮 -->
        <div class="history-btn-area">
            <a href="./history.html" class="history-btn">查看历史版本</a>
        </div>
    </div>

    <script>
        const GITHUB_REPO = "gmaox/deskgamix";
        const API_URL = `https://api.github.com/repos/${GITHUB_REPO}/releases/latest`;
        const ACCELERATE_PREFIX = "https://ghfast.top/";

        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const updateCardEl = document.getElementById('updateCard');
        const versionEl = document.getElementById('version');
        const changelogEl = document.getElementById('changelog');
        const fileListEl = document.getElementById('fileList');
        const linkTypeRadios = document.querySelectorAll('input[name="linkType"]');

        async function fetchAndRenderLatestRelease() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("API请求失败");
                const release = await response.json();

                versionEl.textContent = release.tag_name;
                const changelog = release.body || "暂无更新日志";
                const changelogItems = changelog.split('\n').filter(item => item.trim());
                changelogEl.innerHTML = changelogItems.map(item => `<li>${item.replace(/^- /, '')}</li>`).join('');
                renderFileList(release.assets);

                loadingEl.style.display = "none";
                updateCardEl.style.display = "block";
            } catch (err) {
                console.error("获取版本信息失败：", err);
                loadingEl.style.display = "none";
                errorEl.style.display = "block";
            }
        }

        function renderFileList(assets) {
            fileListEl.innerHTML = '';
            assets.forEach(asset => {
                const officialUrl = asset.browser_download_url;
                const accelerateUrl = ACCELERATE_PREFIX + officialUrl;

                const wrapper = document.createElement('div');
                const btn = document.createElement('a');
                btn.className = "download-btn";
                btn.dataset.official = officialUrl;
                btn.dataset.accelerate = accelerateUrl;
                btn.href = document.querySelector('input[name="linkType"]:checked').value === "accelerate" ? accelerateUrl : officialUrl;
                btn.textContent = "立即下载";

                const fileName = document.createElement('div');
                fileName.className = "file-name";
                fileName.textContent = asset.name;

                wrapper.appendChild(btn);
                wrapper.appendChild(fileName);
                fileListEl.appendChild(wrapper);
            });
        }

        linkTypeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                const selectedType = radio.value;
                document.querySelectorAll('.download-btn').forEach(btn => {
                    btn.href = btn.dataset[selectedType];
                });
            });
        });

        window.onload = fetchAndRenderLatestRelease;
    </script>
</body>
</html>